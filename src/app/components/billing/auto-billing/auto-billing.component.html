<div class="p-grid">
    <div class="p-col-12">
        <p-toast></p-toast>
        <h5>Auto Billing Management</h5>
        <div class="card">
            <p-toolbar>
                <div class="p-toolbar-group-left">
                    <div class="p-fluid p-formgrid p-grid">
                        <div class="p-field p-col p-col-2" >
                            <p class ="toggle-inline">{{autoEnbledText}}</p>
                            <p-inputSwitch id="enabled" (onChange)="handleEnableChange($event)" [(ngModel)]="autoBillingEnabled" [readonly]="true"></p-inputSwitch>
                        </div>
                        <div class="p-field p-col p-col-4">
                            <label for="effectiveDate">Process Date</label>
                            <p-calendar [(ngModel)]="effectiveDate" [showIcon]="true" [minDate]="minDateValue" [maxDate]="maxDateValue" inputId="effectiveDate" [disabled]="true"></p-calendar>
                        </div>
                        <div class="p-field p-col p-col-4">
                            <label for="throughDate">Through Date</label>
                            <p-calendar [(ngModel)]="throughDate" [showIcon]="true" inputId="throughDate" [minDate]="minDateValue" [maxDate]="maxDateValue" [disabled]="true"></p-calendar>
                        </div>
                        <div class="p-field p-col p-col-2">
                            <p class ="toggle-inline">{{autoRunText}}</p>
                            <p-inputSwitch id="pause" (onChange)="handlePauseChange($event)" [(ngModel)]="autoBillingRunStatus" [readonly]="true"></p-inputSwitch>
                        </div>
                    </div>
                </div>
                <div class="p-toolbar-group-right">
                    <button pButton pRipple label="Back" icon="pi pi-arrow-left" *ngIf="showDetail" (click)="goBack()"></button>
                </div>
            </p-toolbar>
        </div>
    </div>
    <div class="p-col-12">
    <div class="card" *ngIf="showMain">
        <p-table #dt [value]="billingDocuments" [columns]="cols" [rows]="10" [paginator]="true" resizableColumns="true" [showCurrentPageReport]="true" styleClass="p-datatable-sm"
                  currentPageReportTemplate="Showing {first} to {last} of {totalRecords} record(s)">
            <ng-template pTemplate="header">
                <tr>
                  <th pSortableColumn="createdDate" class="ui-resizable-column" pResizableColumn width="15%">                   
                        Created
                    <p-columnFilter class="table-header-left" type="text" field="createdDate" display="menu"></p-columnFilter>
                  </th>
                  <th pSortableColumn="billingType" class="ui-resizable-column" pResizableColumn width="15%">              
                        Billing
                    <p-columnFilter class="table-header-left" type="text" field="billingType" display="menu"></p-columnFilter>
                </th>
                <th pSortableColumn="invoiceType" class="ui-resizable-column" pResizableColumn width="15%">           
                        Invoice Type
                    <p-columnFilter class="table-header-left" type="text" field="invoiceType" display="menu"></p-columnFilter>
                </th>
                <th pSortableColumn="throughDate" class="ui-resizable-column" pResizableColumn width="15%">           
                        Through Date
                    <p-columnFilter class="table-header-left" type="text" field="throughDate" display="menu"></p-columnFilter>
                </th>
                  <th pSortableColumn="invoiceCount" class="ui-resizable-column" pResizableColumn width="15%">               
                        # Invoice
                    <p-columnFilter class="table-header-left" type="text" field="invoiceCount" display="menu"></p-columnFilter>
                  </th>
                  <th pSortableColumn="totalAmount" class="ui-resizable-column" pResizableColumn width="15%">            
                      Total
                    <p-columnFilter class="table-header-left" type="text" field="totalAmount" display="menu"></p-columnFilter>
                </th>
                  <th width="7%" >Status?</th>
                  <th width="7%" >Finalized?</th>
                  <th width="7%" >Regenerate?</th>
                  <th width="7%" >View</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-item>
                <tr class="maxTableRow">
                <td>
                    {{ item.createdDate | date:"MM/dd/yyyy"}}
                </td>
              
                <td>
                    {{ item.billingType }}
                </td>
                <td>
                    {{ item.invoiceType }}
                </td>
                <td>
                    {{ item.throughDate | date:"MM/dd/yyyy" }}
                </td>
                <td>
                    {{ item.invoiceCount }}
                </td>
                <td>
                    {{ item.totalAmount | currency}}
                </td>
                <td style="text-align:center">
                    <button pButton *ngIf="item.status===0" type="button" icon="pi pi-spin pi-spinner" class="p-button-rounded" styleClass="p-button-sm"></button>
                    <button pButton *ngIf="item.status===1" type="button" icon="pi pi-file" class="p-button-rounded" styleClass="p-button-sm"></button>
                    <button pButton *ngIf="item.status===2" type="button" icon="pi pi-check" class="p-button-rounded" styleClass="p-button-sm"></button>
                </td>
                <td style="text-align:center">
                    <button pButton *ngIf="item.isFinalized===1" type="button" icon="pi pi-check" class="p-button-rounded p-button-warning" styleClass="p-button-sm"></button>
                    <button pButton *ngIf="item.isFinalized===0" type="button" icon="pi pi-times" class="p-button-rounded p-button-warning" styleClass="p-button-sm"></button>
                </td>
                <td style="text-align:center">
                    <button pButton *ngIf="item.status===1" type="button" icon="pi pi-refresh" class="p-button-rounded p-button-danger" styleClass="p-button-sm" (click)="regenrateDraft(item)"></button>
                    <button pButton *ngIf="item.status===0" type="button" icon="pi pi-refresh" class="p-button-rounded p-button-danger" [disabled]="true" styleClass="p-button-sm" ></button>
                </td>
                <td style="text-align:center">
                    <button pButton type="button" icon="pi pi-book" class="p-button-rounded p-button-info" styleClass="p-button-sm" (click)="showDetails(item)"></button>
                  </td>
                </tr>
            </ng-template>
            </p-table>
    </div>
        <div class="card" *ngIf="showDetail">
            <p-toolbar>
                <div class="p-toolbar-group-left">
                    <div style="text-align: right">
                        <i class="fa fa-search" style="margin:4px 4px 0 0"></i>
                        <input type="text" pInputText size="50" placeholder="Search .." (input)="draft.filterGlobal($event.target.value, 'contains')"
                         style="width:auto">
                    </div>
                </div>
                <div class="p-toolbar-group-right">
                    <p-button label="Members"  icon="pi pi-users" badge="{{draftMemberCount}}" styleClass="p-mr-2"></p-button>
                    <p-button label="Revenue" icon="pi pi-dollar" styleClass="p-button-warning" badge="{{draftRevenue | currency}}" badgeClass="p-badge-danger"></p-button>
                </div>
            </p-toolbar>
            
        <p-table #draft [value]="billingDraft" [columns]="cols" [rows]="10" [paginator]="true" resizableColumns="true" [showCurrentPageReport]="true" styleClass="p-datatable-sm"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} record(s)" [globalFilterFields]="['firstName','lastName']">
            <ng-template pTemplate="caption">
            </ng-template>
                <ng-template pTemplate="header">
                    <tr>
                        <th pSortableColumn="createdDate" class="ui-resizable-column" pResizableColumn width="15%">
                                Created
                            <p-columnFilter class="table-header-left" type="text" field="createdDate" display="menu"></p-columnFilter>
                        </th>
                    <th pSortableColumn="name" class="ui-resizable-column" pResizableColumn width="30%"> 
                            Name
                        <p-columnFilter class="table-header-left" type="text" field="name" display="menu"></p-columnFilter>
                    </th>
                   
                    <th pSortableColumn="cardNumber" class="ui-resizable-column" pResizableColumn width="15%">  
                            Card Number
                        <p-columnFilter class="table-header-left" type="text" field="cardNumber" display="menu"></p-columnFilter>
                    </th>
                    <th pSortableColumn="cardType" class="ui-resizable-column" pResizableColumn width="15%">
                            Card Type
                        <p-columnFilter class="table-header-left" type="text" field="cardType" display="menu"></p-columnFilter>
                    </th>
                    <th pSortableColumn="expirationDate" class="ui-resizable-column" pResizableColumn width="15%">
                            Expires
                        <p-columnFilter class="table-header-left" type="text" field="expirationDate" display="menu"></p-columnFilter>
                    </th>
                    <th pSortableColumn="nextDueDate" class="ui-resizable-column" pResizableColumn width="15%">
                        Due Date
                        <p-columnFilter class="table-header-left" type="text" field="nextDueDate" display="menu"></p-columnFilter>
                    </th>
                    <th pSortableColumn="amount" class="ui-resizable-column" pResizableColumn width="15%">
                            Amount
                        <p-columnFilter class="table-header-left" type="text" field="amount" display="menu"></p-columnFilter>
                    </th>
                    <th width="5%"></th>
                </tr>
                </ng-template>
                <ng-template pTemplate="body" let-item>
                    <tr class="maxTableRow">
                        <td>
                            {{ item.createDate | date:"MM/dd/yyyy"}}
                        </td>
                    <td>
                        {{ item.name}}
                    </td>
                
                    <td>
                        {{ item.cardNumber }}
                    </td>
                    <td>
                        {{ item.cardType }}
                    </td>
                    <td>
                        {{ item.expirationDate }}
                    </td>
                    <td>
                        {{ item.nextDueDate | date:"MM/dd/yyyy"}}
                    </td>
                    <td>
                    {{ item.amount | currency}}
                    </td>
                        <td>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        
    </div>
</div>
<p-confirmDialog [style]="{ width: '450px' }"></p-confirmDialog>